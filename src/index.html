<!DOCTYPE html>
<html>
<head>
    <title>The Twin's Strike: Creation Myth</title>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background: #1a1a1a; 
            color: #fff; 
            font-family: 'Courier New', monospace; 
            display: flex; 
            flex-direction: row; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            overflow: hidden;
        }

        /* LEFT SIDE: UI */
        #ui { 
            width: 300px; 
            text-align: left; 
            padding: 40px; 
            background: #2b2b2b;
            border-right: 4px solid #5D4037;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
        }

        h2 { color: #FFD700; text-transform: uppercase; font-size: 1.8em; margin-bottom: 15px; }
        p { margin-bottom: 8px; font-size: 1.1em; line-height: 1.3; }
        b { color: #87CEEB; }

        #objectives p { margin-bottom: 4px; font-size: 1.0em; } 

        #statusDisplay { 
            color: #FF5722; 
            font-weight: bold; 
            font-size: 1.3em; 
            margin-top: 15px; 
            border-top: 2px solid #555; 
            padding-top: 15px;
        }
        
        #progressDisplay { font-size: 1.2em; color: #FFF; margin-top: 10px; }
        #startMsg { margin-top: 25px; font-weight: bold; color: #4CAF50; font-size: 1.2em; animation: pulse 1s infinite; }

        /* RIGHT SIDE: GAME */
        canvas { 
            background: linear-gradient(to right, #87CEEB, #E0F7FA); 
            border: 8px solid #5D4037; 
            box-shadow: 0 0 30px rgba(0,0,0,0.7); 
            margin-left: 50px;
            max-width: 60vw;
            max-height: 90vh;
        }

        .hidden { display: none; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>

    <div id="ui">
        <h2>The Twin's Strike</h2>
        
        <p><b>CONTROLS:</b></p>
        <p>Phase 1 & 2: <br>Press <b>SPACEBAR</b> to Fly.</p>
        <p>Phase 3 (Horn): <br>Use <b>WASD</b> or <b>ARROWS</b> to Charge.</p>
        
        <p id="statusDisplay">PHASE 1:<br>THE 7 YEAR PURSUIT</p>
        
        <div id="objectives">
            <p>1. Free <b>7 Animals</b>.</p>
            <p>2. Catch the <b>Golden Buck</b>.</p>
            <p>3. Grab the <b>Horn</b>.</p>
            <p>4. <b>CHARGE THE BOSS!</b></p>
        </div>
        
        <p id="progressDisplay">Animals Freed: 0 / 7</p>
        <p id="startMsg">Press Space to Start</p>
    </div>

    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const progressEl = document.getElementById('progressDisplay');
        const startMsg = document.getElementById('startMsg');
        const statusEl = document.getElementById('statusDisplay');

        // --- LOAD IMAGES (Updated to use 'sprites' folder) ---
        const imgHero = new Image();       imgHero.src = '../sprites/hero.png';
        const imgHeroGold = new Image();   imgHeroGold.src = '../sprites/hero_gold.png';
        const imgAnimal = new Image();     imgAnimal.src = '../sprites/animal.png';
        const imgBuck = new Image();       imgBuck.src = '../sprites/buck.png';
        const imgBoss = new Image();       imgBoss.src = '../sprites/boss.png';
        const imgHorn = new Image();       imgHorn.src = '../sprites/horn.png';
        const imgProjectile = new Image(); imgProjectile.src = '../sprites/projectile.png';

        // GAME SETTINGS
        const ANIMALS_NEEDED = 7; 
        const SPEED = 3; 
        
        let gameRunning = false;
        let gameState = 'start'; 
        let frames = 0;
        let animalsFreed = 0; 

        const keys = { up: false, down: false, left: false, right: false };

        // Player (Teharonghyawago)
        const player = {
            x: 100, y: 300, 
            radius: 15, 
            velocity: 0, 
            gravity: 0.25, 
            jump: -6.5,    
            hasHorn: false    
        };

        let obstacles = [];
        let items = [];
        let projectiles = [];
        
        // Boss Object
        const boss = {
            x: 0, 
            y: 0, 
            w: 100, h: 100, 
            dir: 1, speed: 2.0, active: false
        };

        let horn = { x: -100, y: -100, active: false };

        function init() {
            player.x = 100;  
            player.y = canvas.height / 2; 
            player.velocity = 0;
            player.hasHorn = false;
            player.radius = 15; 

            keys.up = false; keys.down = false; 
            keys.left = false; keys.right = false;

            obstacles = [];
            items = [];
            projectiles = [];
            animalsFreed = 0;
            frames = 0;
            
            boss.active = false;
            boss.x = canvas.width - 120; 
            boss.y = canvas.height / 2;
            horn.active = false;

            gameState = 'playing';
            statusEl.innerText = "PHASE 1:\nTHE 7 YEAR PURSUIT";
            progressEl.innerText = "Animals Freed: 0 / " + ANIMALS_NEEDED;
            gameRunning = true;
            startMsg.classList.add('hidden');
            loop();
        }

        function spawnObstacle() {
            if (gameState !== 'playing' && gameState !== 'deerSpawned') return;

            const gap = 160; 
            let lastGapY = obstacles.length > 0 ? obstacles[obstacles.length - 1].gapY : canvas.height / 2;
            
            let maxVariation = 150; 
            let minY = 50; 
            let maxY = canvas.height - gap - 50;
            
            let gapY = Math.random() * (maxY - minY) + minY;
            
            if (Math.abs(gapY - lastGapY) > maxVariation) {
                gapY = lastGapY + (gapY > lastGapY ? maxVariation : -maxVariation);
            }

            obstacles.push({ x: canvas.width, w: 50, gapY: gapY, gapH: gap, passed: false });

            let itemX = canvas.width + 15;
            let itemY = gapY + (gap / 2) - 15;

            if (gameState === 'deerSpawned') {
                 items.push({
                    x: itemX, y: itemY, 
                    w: 60, h: 60, 
                    type: 'buck', collected: false
                });
                statusEl.innerText = "ü¶å CATCH THE BUCK! ü¶å";
                gameState = 'playing'; 
            } 
            else if (animalsFreed < ANIMALS_NEEDED && Math.random() < 0.5) {
                items.push({
                    x: itemX, y: itemY, 
                    w: 40, h: 40, 
                    type: 'animal', collected: false
                });
            }
        }

        function spawnBossProjectile() {
            projectiles.push({
                x: boss.x, y: boss.y + boss.h/2, 
                w: 30, h: 30, // Square
                color: '#000'
            });
        }

        function update() {
            // MOVEMENT
            if (player.hasHorn) {
                player.velocity = 0; 
                let moveSpeed = 6; 
                if (keys.up) player.y -= moveSpeed;
                if (keys.down) player.y += moveSpeed;
                if (keys.left) player.x -= moveSpeed;
                if (keys.right) player.x += moveSpeed;

                if (player.x < player.radius) player.x = player.radius;
                if (player.x > canvas.width - player.radius) player.x = canvas.width - player.radius;
                if (player.y < player.radius) player.y = player.radius;
                if (player.y > canvas.height - player.radius) player.y = canvas.height - player.radius;
            } else {
                player.velocity += player.gravity;
                player.y += player.velocity;
                if (player.y + player.radius >= canvas.height || player.y - player.radius <= 0) {
                    gameOver();
                }
            }

            // GAME STATE LOGIC
            if (gameState === 'playing' || gameState === 'deerSpawned') {
                if (frames % 120 === 0) { 
                    if (animalsFreed >= ANIMALS_NEEDED && !items.some(i => i.type === 'buck')) {
                        gameState = 'deerSpawned'; 
                    }
                    spawnObstacle();
                }
            }

            if (gameState === 'waitingForBoss') {
                if (obstacles.length === 0) {
                    gameState = 'boss';
                    boss.active = true;
                    statusEl.innerText = "‚öîÔ∏è AVOID TAWISKARON ‚öîÔ∏è";
                    setTimeout(() => { spawnHorn(); }, 4000);
                }
            }

            // PIPES
            for (let i = 0; i < obstacles.length; i++) {
                let ob = obstacles[i];
                ob.x -= SPEED;
                if (!player.hasHorn) {
                    if (player.x + player.radius > ob.x && player.x - player.radius < ob.x + ob.w) {
                        if (player.y - player.radius < ob.gapY || player.y + player.radius > ob.gapY + ob.gapH) {
                            gameOver();
                        }
                    }
                }
                if (ob.x + ob.w < 0) { obstacles.shift(); i--; }
            }

            // ITEMS
            for (let i = 0; i < items.length; i++) {
                let item = items[i];
                item.x -= SPEED;
                
                if (!item.collected &&
                    player.x < item.x + item.w && player.x + player.radius > item.x &&
                    player.y < item.y + item.h && player.y + player.radius > item.y) {
                    
                    item.collected = true;
                    
                    if (item.type === 'buck') {
                        gameState = 'waitingForBoss';
                        statusEl.innerText = "‚ö†Ô∏è THE BUCK REVEALS THE WEAKNESS... ‚ö†Ô∏è";
                        progressEl.innerText = "Target Acquired";
                        items = []; 
                        break; 
                    } else if (item.type === 'animal') {
                        animalsFreed++;
                        progressEl.innerText = "Animals Freed: " + animalsFreed + " / " + ANIMALS_NEEDED;
                    }
                }
                if (item.x + item.w < 0 || item.collected) { items.splice(i, 1); i--; }
            }

            // BOSS FIGHT
            if (gameState === 'boss' && boss.active) {
                boss.y += boss.speed * boss.dir;
                if (boss.y < 20 || boss.y + boss.h > canvas.height - 20) boss.dir *= -1;
                if (frames % 90 === 0) spawnBossProjectile();

                for (let i = 0; i < projectiles.length; i++) {
                    let p = projectiles[i];
                    p.x -= 6; 
                    if (player.x - player.radius < p.x + p.w && 
                        player.x + player.radius > p.x &&
                        player.y - player.radius < p.y + p.h && 
                        player.y + player.radius > p.y) {
                        gameOver();
                    }
                    if (p.x < 0) { projectiles.splice(i, 1); i--; }
                }

                if (horn.active) {
                    horn.x -= SPEED;
                    if (player.x - player.radius < horn.x + 80 && 
                        player.x + player.radius > horn.x &&
                        player.y - player.radius < horn.y + 80 && 
                        player.y + player.radius > horn.y) {
                        
                        horn.active = false;
                        player.hasHorn = true;
                        player.radius = 25; 
                        statusEl.innerText = "USE ARROW KEYS TO CHARGE!";
                    }
                    if (horn.x < -50) {
                        horn.active = false;
                        statusEl.innerText = "The Horn returns...";
                        setTimeout(() => { spawnHorn(); }, 3000);
                    }
                }

                if (player.x + player.radius > boss.x && player.y > boss.y && player.y < boss.y + boss.h) {
                    if (player.hasHorn) { gameWin(); } else { gameOver(); }
                }
            }
            frames++;
        }

        function spawnHorn() {
            if (!gameRunning || gameState !== 'boss' || player.hasHorn) return;
            horn.active = true; 
            horn.x = canvas.width + 50; 
            horn.y = canvas.height/2; 
            statusEl.innerText = "‚ú® GRAB THE HORN! ‚ú®";
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw Pipes
            ctx.fillStyle = '#546E7A';
            obstacles.forEach(ob => {
                ctx.fillRect(ob.x, 0, ob.w, ob.gapY);
                ctx.fillRect(ob.x, ob.gapY + ob.gapH, ob.w, canvas.height);
                ctx.fillStyle = '#37474F';
                ctx.fillRect(ob.x + 5, 0, 5, ob.gapY);
                ctx.fillRect(ob.x + 5, ob.gapY + ob.gapH, 5, canvas.height);
                ctx.fillStyle = '#546E7A';
            });

            // Draw Items
            items.forEach(item => {
                let img = item.type === 'buck' ? imgBuck : imgAnimal;
                try { 
                    let nudgeLeft = 8; 
                    ctx.drawImage(img, (item.x - 5) - nudgeLeft, item.y - 5, item.w + 10, item.h + 10); 
                } 
                catch(e) { 
                    ctx.fillStyle = item.type === 'buck' ? 'gold' : 'white'; 
                    ctx.fillRect(item.x, item.y, item.w, item.h); 
                }
            });

            // Draw Boss
            if (gameState === 'boss') {
                try { 
                    ctx.drawImage(imgBoss, boss.x - 10, boss.y - 10, boss.w + 20, boss.h + 20); 
                }
                catch(e) { ctx.fillStyle = '#444'; ctx.fillRect(boss.x, boss.y, boss.w, boss.h); }
                
                // --- PROJECTILE SPRITES ---
                projectiles.forEach(p => {
                    try { 
                        // Draw projectile slightly larger than hitbox
                        ctx.drawImage(imgProjectile, p.x - 5, p.y - 5, p.w + 10, p.h + 10); 
                    }
                    catch(e) { 
                        ctx.fillStyle = '#000'; ctx.fillRect(p.x, p.y, p.w, p.h); 
                    }
                });

                if (horn.active) {
                    try { ctx.drawImage(imgHorn, horn.x, horn.y, 80, 80); } 
                    catch(e) { ctx.fillStyle = 'brown'; ctx.fillRect(horn.x, horn.y, 60, 60); }
                }
            }

            // Draw Player
            let pSize = player.radius * 2;
            let drawSize = pSize + 20; 
            let offset = 10; 

            let currentHeroImg = player.hasHorn ? imgHeroGold : imgHero;
            
            try { 
                ctx.drawImage(currentHeroImg, (player.x - player.radius) - offset, (player.y - player.radius) - offset, drawSize, drawSize); 
            }
            catch(e) { 
                ctx.fillStyle = player.hasHorn ? 'gold' : 'green'; 
                ctx.beginPath(); ctx.arc(player.x, player.y, player.radius, 0, Math.PI*2); ctx.fill(); 
            }
        }

        function loop() {
            if (!gameRunning) return;
            update();
            draw();
            requestAnimationFrame(loop);
        }

        function gameOver() {
            gameRunning = false;
            statusEl.innerText = "üíÄ DEFEAT üíÄ";
            startMsg.innerHTML = "GAME OVER<br>Press Space to Restart";
            startMsg.classList.remove('hidden');
        }

        function gameWin() {
            gameRunning = false;
            statusEl.innerText = "üèÜ VICTORY üèÜ";
            startMsg.innerHTML = "VICTORY!<br>Teharonghyawago defeated Flint!<br>Press Space to Play Again";
            startMsg.classList.remove('hidden');
        }

        function inputAction() {
            if (!gameRunning) { init(); } 
            else if (!player.hasHorn) { player.velocity = player.jump; }
        }

        window.addEventListener('keydown', e => {
            if (e.code === 'Space') inputAction();
            if (['ArrowUp', 'KeyW'].includes(e.code)) keys.up = true;
            if (['ArrowDown', 'KeyS'].includes(e.code)) keys.down = true;
            if (['ArrowLeft', 'KeyA'].includes(e.code)) keys.left = true;
            if (['ArrowRight', 'KeyD'].includes(e.code)) keys.right = true;
        });

        window.addEventListener('keyup', e => {
            if (['ArrowUp', 'KeyW'].includes(e.code)) keys.up = false;
            if (['ArrowDown', 'KeyS'].includes(e.code)) keys.down = false;
            if (['ArrowLeft', 'KeyA'].includes(e.code)) keys.left = false;
            if (['ArrowRight', 'KeyD'].includes(e.code)) keys.right = false;
        });
    </script>
</body>
</html>